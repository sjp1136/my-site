!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.SVGInjector=e()}(this,function(){"use strict";var i=function(t){return t.cloneNode(!0)},a={},n={},l=function(t,e){n[t]=n[t]||[],n[t].push(e)},s=function(r){for(var t=0,e=n[r].length;t<e;t++)!function(e){setTimeout(function(){if(Array.isArray(n[r])){var t=n[r][e];if(a[r]instanceof SVGSVGElement)t(null,i(a[r]));else{if(!(a[r]instanceof Error))throw new Error("Cannot process requestQueue for "+r);t(a[r])}e===n[r].length-1&&delete n[r]}},0)}(t)},j="http://www.w3.org/1999/xlink",M=[],T={},V=0,d=function(S,E,t,x,k){var e=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),G=S.getAttribute("data-src")||S.getAttribute("src");if(/\.svg/i.test(G))if(e)-1===M.indexOf(S)&&(M.push(S),S.setAttribute("src",""),function(r,t){var n="file:"===window.location.protocol;if(void 0!==a[r]){if(a[r]instanceof SVGSVGElement)return t(null,i(a[r]));if(a[r]instanceof Error)return t(a[r]);l(r,t)}else{if(!window.XMLHttpRequest)return t(new Error("Browser does not support XMLHttpRequest"));a[r]={},l(r,t);var o=new XMLHttpRequest;o.onreadystatechange=function(){try{if(4===o.readyState){if(404===o.status||null===o.responseXML)throw new Error(n?"Note: SVG injection ajax calls do not work locally without adjusting security setting in your browser. Or consider using a local webserver.":"Unable to load SVG file: "+r);if(!(200===o.status||n&&0===o.status))throw new Error("There was a problem injecting the SVG: "+o.status+" "+o.statusText);if(o.responseXML instanceof Document)a[r]=o.responseXML.documentElement;else if(DOMParser&&DOMParser instanceof Function){var e;try{e=(new DOMParser).parseFromString(o.responseText,"text/xml")}catch(t){e=void 0}if(!e||e.getElementsByTagName("parsererror").length)throw new Error("Unable to parse SVG file: "+r);a[r]=e.documentElement}s(r)}}catch(t){a[r]=t,s(r)}},o.open("GET",r),o.overrideMimeType&&o.overrideMimeType("text/xml"),o.send()}}(G,function(t,c){if(t)return k(t),!1;var e=S.getAttribute("id");e&&c.setAttribute("id",e);var r=S.getAttribute("title");r&&c.setAttribute("title",r);var n=[].concat(c.getAttribute("class")||[],"injected-svg",S.getAttribute("class")||[]).join(" ");c.setAttribute("class",function(t){for(var e={},r=(t=t.split(" ")).length,n=[];r--;)e.hasOwnProperty(t[r])||(e[t[r]]=1,n.unshift(t[r]));return n.join(" ")}(n));var o=S.getAttribute("style");o&&c.setAttribute("style",o);var i=[].filter.call(S.attributes,function(t){return/^data-\w[\w-]*$/.test(t.name)});if(Array.prototype.forEach.call(i,function(t){t.name&&t.value&&c.setAttribute(t.name,t.value)}),x){var f,p,d,h,v,w={clipPath:["clip-path"],"color-profile":["color-profile"],cursor:["cursor"],filter:["filter"],linearGradient:["fill","stroke"],marker:["marker","marker-start","marker-mid","marker-end"],mask:["mask"],pattern:["fill","stroke"],radialGradient:["fill","stroke"]};Object.keys(w).forEach(function(t){d=w[f=t];for(var e=0,r=(p=c.querySelectorAll("defs "+f+"[id]")).length;e<r;e++){var o;h=p[e].id,v=h+"-"+V,Array.prototype.forEach.call(d,function(t){for(var e=0,r=(o=c.querySelectorAll("["+t+'*="'+h+'"]')).length;e<r;e++){var n=o[e].getAttribute(t);n&&!n.match(new RegExp("url\\(#"+h+"\\)"))||o[e].setAttribute(t,"url(#"+v+")")}});for(var n=c.querySelectorAll("[*|href]"),i=[],a=0,l=n.length;a<l;a++)n[a].getAttributeNS(j,"href").toString()==="#"+p[e].id&&i.push(n[a]);for(var s=0,u=i.length;s<u;s++)i[s].setAttributeNS(j,"href","#"+v);p[e].id=v}})}c.removeAttribute("xmlns:a");for(var a,l,s=c.querySelectorAll("script"),u=[],g=0,m=s.length;g<m;g++)(l=s[g].getAttribute("type"))&&"application/ecmascript"!==l&&"application/javascript"!==l||(a=s[g].innerText||s[g].textContent,u.push(a),c.removeChild(s[g]));if(0<u.length&&("always"===E||"once"===E&&!T[G])){for(var b=0,A=u.length;b<A;b++)new Function(u[b])(window);T[G]=!0}var y=c.querySelectorAll("style");Array.prototype.forEach.call(y,function(t){t.textContent+=""}),c.setAttribute("xmlns","http://www.w3.org/2000/svg"),c.setAttribute("xmlns:xlink",j),S.parentNode.replaceChild(c,S),delete M[M.indexOf(S)],V++,k(S=null,c)}));else{var r=S.getAttribute("data-fallback")||S.getAttribute("data-png");r?(S.setAttribute("src",r),k()):t?(S.setAttribute("src",t+"/"+G.split("/").pop().replace(".svg",".png")),k()):k(new Error("This browser does not support SVG and no PNG fallback was defined."))}else k(new Error("Attempted to inject a file with a non-svg extension: "+G))};return function(r,t,n){var e=void 0===t?{}:t,o=e.evalScripts,i=void 0===o?"always":o,a=e.pngFallback,l=void 0!==a&&a,s=e.each,u=void 0===s?function(){}:s,c=e.renumerateIRIElements,f=void 0===c||c;if(void 0===n&&(n=function(){}),void 0!==r.length){var p=0;Array.prototype.forEach.call(r,function(t){d(t,i,l,f,function(t,e){u(t,e),r.length===++p&&n(p)})})}else r?d(r,i,l,f,function(t,e){u(t,e),n(1),r=null}):n(0)}});
